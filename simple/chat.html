<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bouvetone websockets</title>
    <meta name="description" content="bouvetone websockets">
    <meta name="author" content="christopher olaussen">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <link href="bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
      }
    </style>
    
    
    
    <script type="text/javascript" src="prototype.js"></script>
    
    <script type="text/javascript">
        document.observe("dom:loaded", function() {
            function log(text) {
                $("log").innerHTML = (new Date).getTime() + ": " + (!Object.isUndefined(text) && text !== null ? text.escapeHTML() : "null") + $("log").innerHTML;
            }

            if (!window.WebSocket) {
                alert("WebSocket not natively supported, falling back to Flash");
                      
            } else {
                log("Using browser's native WebSocket implementation")
            }

            var ws;

            $("uriForm").observe("submit", function(e) {
                e.stop();
                ws = new WebSocket($F("uri"));
                ws.onopen = function() {
                    log("[WebSocket#onopen]\n");
                }
                ws.onmessage = function(e) {
                    log("[WebSocket#onmessage] Message: '" + e.data + "'\n");
                }
                ws.onclose = function() {
                    log("[WebSocket#onclose]\n");
                    $("uri", "connect").invoke("enable");
                    $("disconnect").disable();
                    ws = null;
                }
                $("uri", "connect").invoke("disable");
                $("disconnect").enable();
            });

            $("sendForm").observe("submit", function(e) {
                e.stop();
                if (ws) {
                    var textField = $("textField");
                    ws.send(textField.value);
                    log("[WebSocket#send]      Send:    '" + textField.value + "'\n");
                    textField.value = "";
                    textField.focus();
                }
            });

            $("disconnect").observe("click", function(e) {
                e.stop();
                if (ws) {
                    ws.close();
                }
            });
        });
    </script>
  </head>
  
	
	<body>
	  	<div class="topbar">
	      <div class="fill">
	        <div class="container">
	          <a class="brand" href="#">BouvetOne</a>
	          <ul class="nav">
	            <li class="active"><a href="#">Websockets</a></li>
	          </ul>
	        </div>
	      </div>
	    </div>
	    
		<div class="container">
		<div class="hero-unit">
		 	
		 	<h2>websockets</h2>
		 	
	    	<form id="uriForm">
	      		<input type="text" class="btn large" id="uri" value="ws://localhost:8887" style="width:200px;"> <input type="submit" class="btn primary large" id="connect" value="Connect" style="margin-right:20px"><input type="button" class="btn large" id="disconnect" value="Disconnect" disabled="disabled">
	      	</form>
	      
	      	<form id="sendForm">
	      		<input  type="text" class="btn large" id="textField" value="" style="width:200px;"> <input type="submit" class="btn primary large" value="Send">
	      	</form>
	      	<form>
	      		<textarea class="span14" id="log" rows="30" cols="400" style="font-family:monospace; color:black;"></textarea>
	      	</form>
	      	</div>
      </div>
  </body>
</html>